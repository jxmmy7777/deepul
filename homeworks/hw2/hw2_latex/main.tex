\documentclass{article}
\usepackage{amsmath,amssymb}
\usepackage{graphicx}
\usepackage{enumerate}
\usepackage{hyperref}
\usepackage{subcaption}
\usepackage{caption}
\usepackage{xcolor}
\usepackage{float}

\pagestyle{empty} \addtolength{\textwidth}{1.0in}
\addtolength{\textheight}{0.5in}
\addtolength{\oddsidemargin}{-0.5in}
\addtolength{\evensidemargin}{-0.5in}
\newcommand{\ruleskip}{\bigskip\hrule\bigskip}
\newcommand{\nodify}[1]{{\sc #1}}
\newcommand{\points}[1]{{\textbf{[#1 points]}}}
\newcommand{\subquestionpoints}[1]{{[#1 points]}}
\newenvironment{answer}{{\bf Answer:} \sf }{}%

\newcommand{\bitem}{\begin{list}{$\bullet$}%
{\setlength{\itemsep}{0pt}\setlength{\topsep}{0pt}%
\setlength{\rightmargin}{0pt}}}
\newcommand{\eitem}{\end{list}}

\setlength{\parindent}{0pt} \setlength{\parskip}{0.5ex}
\setlength{\unitlength}{1cm}

\newcommand{\pa}[1]{[[PA: #1]]}

\renewcommand{\Re}{{\mathbb R}}
\newcommand{\E}{{\rm E}}
\begin{document}

\pagestyle{myheadings} \markboth{}{CS 294-158 Deep Unsupervised Learning, Homework 2, Spring 2024}

{\huge
\noindent Homework 2: Latent Variable Models}
\ruleskip

{\bf Deliverable}: This PDF write-up by {\bf Wei-Jer Chang Wed February 21st, 23:59pm}.  Your PDF should be generated by simply replacing the placeholder images of this LaTeX document with the appropriate solution images that will be generated automatically when solving each question. The solution images are automatically generated and saved using the accompanying IPython notebook. Your PDF is to be submitted into Gradescope. This PDF already contains a few solution images.  These images will allow you to check your own solution to ensure correctness.


\vspace{.2in}

%--------------------------------------------------------------------------------
%--------------------------------------------------------------------------------
%--------------------------------------------------------------------------------
\noindent {\bf Question 1: VAEs on 2D Data [20pt]}
%--------------------------------------------------------------------------------
%--------------------------------------------------------------------------------
%--------------------------------------------------------------------------------

\begin{enumerate}[(a)]

\item {\bf [10pt] Data from a Full Covariance Gaussian} \\\\
Final -ELBO: 5.4568, Recon Loss: 3.8836, KL Loss: 1.5732 (Dataset 1)
\begin{figure}[H]
    \centering
    \begin{subfigure}{0.32\textwidth}
        \centering
        \includegraphics[width=\textwidth]{figures/q1_a_dset1_train_plot.png}
        \caption{Training curve}
    \end{subfigure}
    \begin{subfigure}{0.32\textwidth}
        \centering
        \includegraphics[width=\textwidth]{figures/q1_a_dset1_sample_with_noise.png}
        \caption{Samples with Noise}
    \end{subfigure}
    \begin{subfigure}{0.32\textwidth}
        \centering
        \includegraphics[width=\textwidth]{figures/q1_a_dset1_sample_without_noise.png}
        \caption{Samples without Noise}
    \end{subfigure}
    \caption{Results for Dataset 1}
\end{figure}
Final Full -ELBO: Final -ELBO: 5.4453, Recon Loss: 3.8504, KL Loss: 1.5949(Dataset 2)
\begin{figure}[H]
    \centering
    \begin{subfigure}{0.32\textwidth}
        \centering
        \includegraphics[width=\textwidth]{figures/q1_a_dset2_train_plot.png}
        \caption{Training curve}
    \end{subfigure}
    \begin{subfigure}{0.32\textwidth}
        \centering
        \includegraphics[width=\textwidth]{figures/q1_a_dset2_sample_with_noise.png}
        \caption{Samples with Noise}
    \end{subfigure}
    \begin{subfigure}{0.32\textwidth}
        \centering
        \includegraphics[width=\textwidth]{figures/q1_a_dset2_sample_without_noise.png}
        \caption{Samples without Noise}
    \end{subfigure}
    \caption{Results for Dataset 2}
\end{figure}

\newpage

\item {\bf [10pt] Data from a Diagonal Gaussian} \\\\
Final Final -ELBO: 5.4358, Recon Loss: 3.7938, KL Loss: 1.6420 (Dataset 1)
\begin{figure}[H]
    \centering
    \begin{subfigure}{0.32\textwidth}
        \centering
        \includegraphics[width=\textwidth]{figures/q1_b_dset1_train_plot.png}
        \caption{Training curve}
    \end{subfigure}
    \begin{subfigure}{0.32\textwidth}
        \centering
        \includegraphics[width=\textwidth]{figures/q1_b_dset1_sample_with_noise.png}
        \caption{Samples with Noise}
    \end{subfigure}
    \begin{subfigure}{0.32\textwidth}
        \centering
        \includegraphics[width=\textwidth]{figures/q1_b_dset1_sample_without_noise.png}
        \caption{Samples without Noise}
    \end{subfigure}
    \caption{Results for Dataset 1}
\end{figure}
Final Final -ELBO: 5.4351, Recon Loss: 3.8261, KL Loss: 1.6091 (Dataset 2)
\begin{figure}[H]
    \centering
    \begin{subfigure}{0.32\textwidth}
        \centering
        \includegraphics[width=\textwidth]{figures/q1_b_dset2_train_plot.png}
        \caption{Training curve}
    \end{subfigure}
    \begin{subfigure}{0.32\textwidth}
        \centering
        \includegraphics[width=\textwidth]{figures/q1_b_dset2_sample_with_noise.png}
        \caption{Samples with Noise}
    \end{subfigure}
    \begin{subfigure}{0.32\textwidth}
        \centering
        \includegraphics[width=\textwidth]{figures/q1_b_dset2_sample_without_noise.png}
        \caption{Samples without Noise}
    \end{subfigure}
    \caption{Results for Dataset 2}
\end{figure}
\textbf{Answer: For a the latents are being used, ( we learn a good mean of the distribution). On the other hand for (b) is ignored. This is because when the decoder is too powerful, we may ignore the latents. }
\end{enumerate}



%--------------------------------------------------------------------------------
%--------------------------------------------------------------------------------
%--------------------------------------------------------------------------------
\newpage
\noindent {\bf Question 2: VAEs on Images [40pt]}
%--------------------------------------------------------------------------------
%--------------------------------------------------------------------------------
%--------------------------------------------------------------------------------

\begin{enumerate}[(a)]
  \item {\bf [20pt] VAE} \\\\
    Final -ELBO: 117.6243, Recon Loss: 93.3558, KL Loss: 24.2686  (Dataset 1)
  \begin{figure}[H]
         \centering
         \begin{subfigure}[b]{0.475\textwidth}
             \centering
             \includegraphics[width=\textwidth]{figures/q2_a_dset1_train_plot.png}
             \caption{Training Curve}
         \end{subfigure}
         \hfill
         \begin{subfigure}[b]{0.475\textwidth}
             \centering
             \includegraphics[width=\textwidth]{figures/q2_a_dset1_samples.png}
             \caption{Samples}
         \end{subfigure}
         \vskip\baselineskip
         \begin{subfigure}[b]{0.475\textwidth}
             \centering
             \includegraphics[width=\textwidth]{figures/q2_a_dset1_reconstructions.png}
             \caption{Reconstructions}
         \end{subfigure}
         \quad
         \begin{subfigure}[b]{0.475\textwidth}
             \centering
             \includegraphics[width=\textwidth]{figures/q2_a_dset1_interpolations.png}
             \caption{Interpolations}
         \end{subfigure}
         \caption{Results for Dataset 1}
     \end{figure}

     \newpage

     Final Final -ELBO: 204.2054, Recon Loss: 147.0967, KL Loss: 57.1087 (Dataset 2)
     \begin{figure}[H]
            \centering
            \begin{subfigure}[b]{0.475\textwidth}
                \centering
                \includegraphics[width=\textwidth]{figures/q2_a_dset2_train_plot.png}
                \caption{Training Curve}
            \end{subfigure}
            \hfill
            \begin{subfigure}[b]{0.475\textwidth}
                \centering
                \includegraphics[width=\textwidth]{figures/q2_a_dset2_samples.png}
                \caption{Samples}
            \end{subfigure}
            \vskip\baselineskip
            \begin{subfigure}[b]{0.475\textwidth}
                \centering
                \includegraphics[width=\textwidth]{figures/q2_a_dset2_reconstructions.png}
                \caption{Reconstructions}
            \end{subfigure}
            \quad
            \begin{subfigure}[b]{0.475\textwidth}
                \centering
                \includegraphics[width=\textwidth]{figures/q2_a_dset2_interpolations.png}
                \caption{Interpolations}
            \end{subfigure}
            \caption{Results for Dataset 2}
        \end{figure}

        \newpage

        \item {\bf [20pt] Hierarchical VAE with Learned Prior} \\\\
        Final -ELBO: 120.5412, Recon Loss: 93.8273, KL Loss: 26.7139 (Dataset 1)
        \begin{figure}[H]
               \centering
               \begin{subfigure}[b]{0.475\textwidth}
                   \centering
                   \includegraphics[width=\textwidth]{figures/q2_b_dset1_train_plot.png}
                   \caption{Training Curve}
               \end{subfigure}
               \hfill
               \begin{subfigure}[b]{0.475\textwidth}
                   \centering
                   \includegraphics[width=\textwidth]{figures/q2_b_dset1_samples.png}
                   \caption{Samples}
               \end{subfigure}
               \vskip\baselineskip
               \begin{subfigure}[b]{0.475\textwidth}
                   \centering
                   \includegraphics[width=\textwidth]{figures/q2_b_dset1_reconstructions.png}
                   \caption{Reconstructions}
               \end{subfigure}
               \quad
               \begin{subfigure}[b]{0.475\textwidth}
                   \centering
                   \includegraphics[width=\textwidth]{figures/q2_b_dset1_interpolations.png}
                   \caption{Interpolations}
               \end{subfigure}
               \caption{Results for Dataset 1}
           \end{figure}

           \newpage

           Final -ELBO: 203.4307, Recon Loss: 153.1637, KL Loss: 50.2670 (Dataset 2)
           \begin{figure}[H]
                  \centering
                  \begin{subfigure}[b]{0.475\textwidth}
                      \centering
                      \includegraphics[width=\textwidth]{figures/q2_b_dset2_train_plot.png}
                      \caption{Training Curve}
                  \end{subfigure}
                  \hfill
                  \begin{subfigure}[b]{0.475\textwidth}
                      \centering
                      \includegraphics[width=\textwidth]{figures/q2_b_dset2_samples.png}
                      \caption{Samples}
                  \end{subfigure}
                  \vskip\baselineskip
                  \begin{subfigure}[b]{0.475\textwidth}
                      \centering
                      \includegraphics[width=\textwidth]{figures/q2_b_dset2_reconstructions.png}
                      \caption{Reconstructions}
                  \end{subfigure}
                  \quad
                  \begin{subfigure}[b]{0.475\textwidth}
                      \centering
                      \includegraphics[width=\textwidth]{figures/q2_b_dset2_interpolations.png}
                      \caption{Interpolations}
                  \end{subfigure}
                  \caption{Results for Dataset 2}
              \end{figure}
\end{enumerate}

%--------------------------------------------------------------------------------
%--------------------------------------------------------------------------------
%--------------------------------------------------------------------------------
\newpage
\noindent {\bf Question 3: VQ-VAE [40pt]}
%--------------------------------------------------------------------------------
%--------------------------------------------------------------------------------
%--------------------------------------------------------------------------------

VQ-VAE Final Test Loss: 2160.6643(summed up latent dimension, mean over batch)
Transformer Prior Final Test Loss: 1.3106 (Dataset 1)
\begin{figure}[H]
       \centering
       \begin{subfigure}[b]{0.475\textwidth}
           \centering
           \includegraphics[width=\textwidth]{figures/q3_dset1_vqvae_train_plot.png}
           \caption{VQ-VAE Training Curve}
       \end{subfigure}
       \hfill
       \begin{subfigure}[b]{0.475\textwidth}
           \centering
           \includegraphics[width=\textwidth]{figures/q3_dset1_prior_train_plot.png}
           \caption{Transformer Prior Training Curve}
       \end{subfigure}
       \vskip\baselineskip
       \begin{subfigure}[b]{0.475\textwidth}
           \centering
           \includegraphics[width=\textwidth]{figures/q3_dset1_samples.png}
           \caption{Samples}
       \end{subfigure}
       \quad
       \begin{subfigure}[b]{0.475\textwidth}
           \centering
           \includegraphics[width=\textwidth]{figures/q3_dset1_reconstructions.png}
           \caption{Reconstructions}
       \end{subfigure}
       \caption{Results for Dataset 1}
   \end{figure}

   \newpage

   Final VQ-VAE Test Loss: 549.5761, PixelCNN Prior Test Los: 2.2399 (Dataset 2)
   \begin{figure}[H]
          \centering
          \begin{subfigure}[b]{0.475\textwidth}
              \centering
              \includegraphics[width=\textwidth]{figures/q3_dset2_vqvae_train_plot.png}
              \caption{VQ-VAE Training Curve}
          \end{subfigure}
          \hfill
          \begin{subfigure}[b]{0.475\textwidth}
              \centering
              \includegraphics[width=\textwidth]{figures/q3_dset2_prior_train_plot.png}
              \caption{PixelCNN Prior Training Curve}
          \end{subfigure}
          \vskip\baselineskip
          \begin{subfigure}[b]{0.475\textwidth}
              \centering
              \includegraphics[width=\textwidth]{figures/q3_dset2_samples.png}
              \caption{Samples}
          \end{subfigure}
          \quad
          \begin{subfigure}[b]{0.475\textwidth}
              \centering
              \includegraphics[width=\textwidth]{figures/q3_dset2_reconstructions.png}
              \caption{Reconstructions}
          \end{subfigure}
          \caption{Results for Dataset 1}
      \end{figure}

%-

\end{document}
